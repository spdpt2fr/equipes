                joueur.niveau.toString().includes(searchTerm)
            );
        }

        function trierJoueurs(joueursListe) {
            const joueursCopie = [...joueursListe];
            if (triJoueurs === 'alpha') {
                return joueursCopie.sort((a, b) => a.nom.localeCompare(b.nom, 'fr', { sensitivity: 'base' }));
            } else {
                return joueursCopie.sort((a, b) => b.niveau - a.niveau || a.nom.localeCompare(b.nom, 'fr', { sensitivity: 'base' }));
            }
        }

        function afficherJoueurs() {
            const carte = document.getElementById('listeJoueursCard');
            const liste = document.getElementById('listeJoueurs');
            const statsElement = document.getElementById('searchStats');

            if (joueurs.length === 0) {
                carte.style.display = 'none';
                return;
            }

            carte.style.display = 'block';
            liste.innerHTML = '';

            // Trier puis filtrer les joueurs
            const joueursTries = trierJoueurs(joueurs);
            const joueursFiltres = filtrerJoueurs(joueursTries);

            // Mettre à jour les statistiques
            const totalJoueurs = joueurs.length;
            const joueursActifs = joueurs.filter(j => j.actif).length;
            const joueursAffiches = joueursFiltres.length;
            
            let statsText = `${totalJoueurs} joueur(s) total`;
            if (joueursActifs !== totalJoueurs) {
                statsText += ` (${joueursActifs} actifs)`;
            }
            if (searchTerm) {
                statsText += ` - ${joueursAffiches} trouvé(s)`;
            }
            statsElement.textContent = statsText;

            joueursFiltres.forEach((j, index) => {
                const originalIndex = joueurs.indexOf(j);
                const playerCard = document.createElement('div');
                playerCard.className = `player-card ${!j.actif ? 'inactive' : ''}`;

                playerCard.innerHTML = `
                    <div class="checkbox-wrapper">
                        <input type="checkbox" ${j.actif ? 'checked' : ''} onchange="modifierJoueur(${originalIndex}, 'actif', this.checked)">
                    </div>
                    <div class="player-info">
                        <div class="player-field">
                            <input type="text" value="${j.nom}" class="player-name-input" 
                                   onchange="modifierJoueur(${originalIndex}, 'nom', this.value)"
                                   onblur="modifierJoueur(${originalIndex}, 'nom', this.value)"
                                   placeholder="Nom du joueur">
                        </div>
                        <div class="player-field">
                            <div class="niveau-wrapper">
                                <span class="niveau-label">Niv.</span>
                                <input type="number" value="${j.niveau}" min="1" max="10" 
                                       onchange="modifierJoueur(${originalIndex}, 'niveau', this.value)"
                                       placeholder="1-10" title="Niveau de 1 à 10">
                            </div>
                        </div>
                        <div class="player-field">
                            <select onchange="modifierJoueur(${originalIndex}, 'poste', this.value)" title="Position du joueur">
                                <option value="avant" ${j.poste==='avant'?'selected':''}>Avant</option>
                                <option value="arriere" ${j.poste==='arriere'?'selected':''}>Arrière</option>
                                <option value="indifferent" ${j.poste==='indifferent'?'selected':''}>Indifférent</option>
                            </select>
                        </div>
                        <div class="player-field">
                            <input type="number" value="${j.groupe || ''}" min="1" 
                                   onchange="modifierJoueur(${originalIndex}, 'groupe', this.value)"
                                   placeholder="Groupe" title="Numéro de groupe (optionnel)">
                        </div>
                    </div>
                    <button onclick="supprimerJoueur(${originalIndex})" class="btn btn-danger">
                        <span class="material-icons">delete</span>
                    </button>
                `;

                liste.appendChild(playerCard);
            });
        }

        function creerEquipes() {
            const nbEquipes = parseInt(document.getElementById('nombreEquipes').value);
            if (isNaN(nbEquipes) || nbEquipes <= 0) {
                showToast('Nombre d\'équipes invalide', true);
                return;
            }

            const joueursActifs = joueurs.filter(j => j.actif);
            if (joueursActifs.length === 0) {
                showToast('Aucun joueur actif disponible', true);
                return;
            }

            equipes = Array.from({length: nbEquipes}, () => ({
                joueurs: [],
                niveauTotal: 0,
                meilleurNiveau: 0,
                avant: 0,
                arriere: 0
            }));

            const groupes = {};
            const sansGroupe = [];

            joueursActifs.forEach(j => {
                if (j.groupe) {
                    if (!groupes[j.groupe]) groupes[j.groupe] = [];
                    groupes[j.groupe].push(j);
                } else {
                    sansGroupe.push(j);
                }
            });

            // Assigner les groupes ensemble
            Object.values(groupes).forEach(groupe => {
                groupe.sort((a,b) => b.niveau - a.niveau);
                equipes.sort((a,b) => a.niveauTotal - b.niveauTotal);
                groupe.forEach(j => {
                    let poste = j.poste;
                    if (poste === 'indifferent') poste = equipes[0].avant <= equipes[0].arriere ? 'avant' : 'arriere';
                    equipes[0].joueurs.push({...j, poste});
                    equipes[0].niveauTotal += j.niveau;
                    equipes[0].meilleurNiveau = Math.max(equipes[0].meilleurNiveau, j.niveau);
                    equipes[0][poste]++;
                });
            });

            // Ajouter les joueurs seuls
            sansGroupe.sort((a,b) => b.niveau - a.niveau);
            sansGroupe.forEach(joueur => {
                equipes.sort((a,b) => a.niveauTotal - b.niveauTotal);
                let poste = joueur.poste;
                if (poste === 'indifferent') poste = equipes[0].avant <= equipes[0].arriere ? 'avant' : 'arriere';
                equipes[0].joueurs.push({...joueur, poste});
                equipes[0].niveauTotal += joueur.niveau;
                equipes[0].meilleurNiveau = Math.max(equipes[0].meilleurNiveau, joueur.niveau);
                equipes[0][poste]++;
            });

            afficherEquipes();
            showToast('Équipes créées avec succès');
        }

        function afficherEquipes() {
            const container = document.getElementById('equipesContainer');
            if (equipes.length === 0) {
                container.innerHTML = '';
                return;
            }

            // Calculer les scores compétitifs
            function scoreEquipe(equipe) {
                let joueursOrdonnes = [...equipe.joueurs].sort((a, b) => b.niveau - a.niveau);
                if (joueursOrdonnes.length > 6) {
                    const joueursPrisEnCompte = joueursOrdonnes.slice(0, 6);
                    const joueursIgnorés = joueursOrdonnes.slice(6);
                    const meilleur = joueursPrisEnCompte[0]?.niveau || 0;
                    const second = joueursPrisEnCompte[1]?.niveau || 0;
                    const total = joueursPrisEnCompte.reduce((acc, j) => acc + j.niveau, 0);
                    return {
                        score: total * 0.6 + meilleur * 0.25 + second * 0.15,
                        meilleur,
                        second,
                        joueursIgnorés
                    };
                } else {
                    const meilleur = joueursOrdonnes[0]?.niveau || 0;
                    const second = joueursOrdonnes[1]?.niveau || 0;
                    const total = equipe.niveauTotal;
                    return {
                        score: total * 0.6 + meilleur * 0.25 + second * 0.15,
                        meilleur,
                        second,
                        joueursIgnorés: []
                    };
                }
            }
            
            const scoresObj = equipes.map(e => scoreEquipe(e));
            const scores = scoresObj.map(e => e.score);

            let html = `
                <div class="card">
                    <h2 class="card-title">
                        <span class="material-icons">groups</span>
                        Équipes Constituées
                        <button onclick="toggleTotalNiveaux()" class="btn btn-secondary" style="margin-left: auto;">
                            ${afficherTotal ? 'Cacher' : 'Afficher'} totaux
                        </button>
                        <button onclick="toggleTriEquipes()" class="btn btn-secondary" style="margin-left: 8px;">
                            Trier : ${triEquipes === 'niveau' ? 'par niveau' : 'alphabétique'}
                        </button>
                    </h2>
                    <div class="teams-grid">
            `;

            equipes.forEach((e, idx) => {
                const teamColors = ['#1976d2', '#388e3c', '#f57c00', '#d32f2f'];
                const color = teamColors[idx % teamColors.length];

                html += `
                    <div class="team-card">
                        <div class="team-title" style="color: ${color}">
                            <span class="material-icons">group</span>
                            Équipe ${idx + 1}
                        </div>
                        <ul class="team-players">
                `;

                // Tri dynamique des joueurs dans les équipes
                let joueursAffiches = [...e.joueurs];
                if (triEquipes === 'niveau') {
                    joueursAffiches.sort((a, b) => b.niveau - a.niveau);
                } else if (triEquipes === 'alpha') {
                    joueursAffiches.sort((a, b) => a.nom.localeCompare(b.nom, 'fr', { sensitivity: 'base' }));
                }

                joueursAffiches.forEach((j, joueurIdx) => {
                    html += `
                        <li class="team-player" onclick="changerEquipe(${idx}, ${e.joueurs.indexOf(j)})">
                            <span class="material-icons">person</span>
                            ${j.nom} - ${j.poste}
                        </li>
                    `;
                });

                html += '</ul>';
                if (afficherTotal) {
                    html += `<div class="team-total">Score compétitif : ${scoresObj[idx].score.toFixed(2)}<br>
                        <span style="font-size:12px;">
                        (Somme × 0.6 : ${(e.joueurs.length > 6 
                            ? [...e.joueurs].sort((a,b) => b.niveau-a.niveau).slice(0,6).reduce((acc, j) => acc+j.niveau,0)
                            : e.niveauTotal
                        ).toFixed(2)}
                        , meilleur × 0.25 : ${(scoresObj[idx].meilleur*0.25).toFixed(2)}
                        , 2e meilleur × 0.15 : ${(scoresObj[idx].second*0.15).toFixed(2)})
                        </span>`;
                    if (scoresObj[idx].joueursIgnorés.length > 0) {
                        html += `<br><span style="color:#d32f2f; font-size:12px;">(Le(s) joueur(s) non pris en compte : ${scoresObj[idx].joueursIgnorés.map(j => j.nom).join(', ')})</span>`;
                    }
                    html += `</div>`;
                }
                html += '</div>';
            });

            html += '</div>';
            // Rapport de force
            html += `
                <div class="vs-stats">
                    <h3><span class="material-icons">bar_chart</span> Rapport de force entre équipes</h3>
            `;

            equipes.forEach((e1, i) => {
                equipes.forEach((e2, j) => {
                    if (i < j) {
                        const ratio = (scores[i] / scores[j]).toFixed(2);
                        const part1 = (ratio * 100 / (1 + Number(ratio))).toFixed(1);
                        const part2 = (100 / (1 + Number(ratio))).toFixed(1);
                        html += `<div class="vs-row">Équipe ${i + 1} vs Équipe ${j + 1} : ${part1}% / ${part2}%</div>`;
                    }
                });
            });

            html += '</div></div>';
            container.innerHTML = html;
        }

        function changerEquipe(equipeIdx, joueurIdx) {
            const nouvelleEquipe = prompt('Numéro de la nouvelle équipe pour ce joueur (commence à 1) :');
            const numEquipe = parseInt(nouvelleEquipe) - 1;
            if (numEquipe >= 0 && numEquipe < equipes.length && numEquipe !== equipeIdx) {
                const joueur = equipes[equipeIdx].joueurs.splice(joueurIdx, 1)[0];
                equipes[numEquipe].joueurs.push(joueur);

                // Recalculer les totaux
                equipes.forEach(e => {
                    e.niveauTotal = e.joueurs.reduce((acc, j) => acc + j.niveau, 0);
                });

                afficherEquipes();
                showToast('Joueur déplacé avec succès');
            }
        }

        function exporterJoueurs() {
            if (joueurs.length === 0) {
                showToast("Aucun joueur à exporter", true);
                return;
            }

            const contenu = joueurs.map(j => `${j.nom},${j.niveau},${j.poste}`).join('\n');
            const blob = new Blob([contenu], { type: "text/plain;charset=utf-8" });
            const url = URL.createObjectURL(blob);

            const a = document.createElement("a");
            a.style.display = "none";
            a.href = url;
            a.download = "joueurs_exportes.csv";
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            showToast("Joueurs exportés avec succès");
        }

        async function importerJoueurs() {
            const fichier = document.getElementById('fichierJoueurs').files[0];
            if (!fichier) {
                showToast("Aucun fichier sélectionné", true);
                return;
            }

            const reader = new FileReader();
            reader.onload = async function(event) {
                let ajouts = 0;
                const lignes = event.target.result.replace(/\r/g, '').split('\n');
                
                for (const ligne of lignes) {
                    const cleanLine = ligne.replace(/^\uFEFF/, '').trim();
                    if (!cleanLine) continue;

                    const sep = cleanLine.includes(';') ? ';' : ',';
                    const [nom, niveauStr, posteStr] = cleanLine.split(sep).map(x => x.trim());

                    if (!nom) continue;
                    
                    // Vérifier si le joueur existe déjà
                    if (joueurs.find(j => j.nom.toLowerCase() === nom.toLowerCase())) {
                        continue;
                    }
                    
                    const niveau = parseInt(niveauStr);
                    const poste = (posteStr || "").toLowerCase();
                    const posteValide = ["avant", "arriere"].includes(poste) ? poste : "indifferent";
                    const niveauValide = (niveau >= 1 && niveau <= 10) ? niveau : 5;

                    const nouveauJoueur = { nom, niveau: niveauValide, poste: posteValide, groupe: null, actif: true };
                    joueurs.push(nouveauJoueur);
                    await sauvegarderJoueur(nouveauJoueur);
                    ajouts++;
                }
                
                afficherJoueurs();
                showToast(`${ajouts} joueur(s) importé(s) avec succès`);
            };
            reader.readAsText(fichier, 'utf-8');
        }

        // ==================== INITIALISATION ====================
        window.onload = async () => {
            console.log("Page chargée - Initialisation...");
            
            // Initialiser Supabase
            await initSupabase();
            
            // Event listeners
            document.getElementById('ajouterBtn').addEventListener('click', ajouterJoueur);
            document.getElementById('exportBtn').addEventListener('click', exporterJoueurs);
            document.getElementById('creerBtn').addEventListener('click', creerEquipes);
            document.getElementById('syncBtn').addEventListener('click', synchroniser);

            // Auto-import quand un fichier est sélectionné
            document.getElementById('fichierJoueurs').addEventListener('change', importerJoueurs);

            // Recherche et tri
            document.getElementById('searchInput').addEventListener('input', rechercherJoueurs);
            document.getElementById('clearSearch').addEventListener('click', effacerRecherche);
            document.getElementById('sortToggle').addEventListener('click', toggleTriJoueurs);

            // Support clavier
            document.getElementById('nom').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') ajouterJoueur();
            });

            document.getElementById('niveau').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') ajouterJoueur();
            });

            document.getElementById('nombreEquipes').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') creerEquipes();
            });

            document.getElementById('searchInput').addEventListener('keypress', function(e) {
                if (e.key === 'Escape') effacerRecherche();
            });
        };
    </script>
</body>
</html>if (!groupes[j.groupe]) groupes[j.groupe] = [];
                    groupes[j.groupe].push(j);
                } else {
                    sansGroupe.push(j);
                }
            });

            // Assigner les groupes ensemble
            Object.values(groupes).forEach(groupe => {
                groupe.sort((a,b) => b.niveau - a.niveau);
                equipes.sort((a,b) => a.niveauTotal - b.niveauTotal);
                groupe.forEach(j => {
                    let poste = j.poste;
                    if (poste === 'indifferent') poste = equipes[0].avant <= equipes[0].arriere ? 'avant' : 'arriere';
                    equipes[0].joueurs.push({...j, poste});
                    equipes[0].niveauTotal += j.niveau;
                    equipes[0].meilleurNiveau = Math.max(equipes[0].meilleurNiveau, j.niveau);
                    equipes[0][poste]++;
                });
            });

            // Ajouter les joueurs seuls
            sansGroupe.sort((a,b) => b.niveau - a.niveau);
            sansGroupe.forEach(joueur => {
                equipes.sort((a,b) => a.niveauTotal - b.niveauTotal);
                let poste = joueur.poste;
                if (poste === 'indifferent') poste = equipes[0].avant <= equipes[0].arriere ? 'avant' : 'arriere';
                equipes[0].joueurs.push({...joueur, poste});
                equipes[0].niveauTotal += joueur.niveau;
                equipes[0].meilleurNiveau = Math.max(equipes[0].meilleurNiveau, joueur.niveau);
                equipes[0][poste]++;
            });

            afficherEquipes();
            showToast('Équipes créées avec succès');
        }

        function afficherEquipes() {
            const container = document.getElementById('equipesContainer');
            if (equipes.length === 0) {
                container.innerHTML = '';
                return;
            }

            // Calculer les scores compétitifs
            function scoreEquipe(equipe) {
                let joueursOrdonnes = [...equipe.joueurs].sort((a, b) => b.niveau - a.niveau);
                if (joueursOrdonnes.length > 6) {
                    const joueursPrisEnCompte = joueursOrdonnes.slice(0, 6);
                    const joueursIgnorés = joueursOrdonnes.slice(6);
                    const meilleur = joueursPrisEnCompte[0]?.niveau || 0;
                    const second = joueursPrisEnCompte[1]?.niveau || 0;
                    const total = joueursPrisEnCompte.reduce((acc, j) => acc + j.niveau, 0);
                    return {
                        score: total * 0.6 + meilleur * 0.25 + second * 0.15,
                        meilleur,
                        second,
                        joueursIgnorés
                    };
                } else {
                    const meilleur = joueursOrdonnes[0]?.niveau || 0;
                    const second = joueursOrdonnes[1]?.niveau || 0;
                    const total = equipe.niveauTotal;
                    return {
                        score: total * 0.6 + meilleur * 0.25 + second * 0.15,
                        meilleur,
                        second,
                        joueursIgnorés: []
                    };
                }
            }
            
            const scoresObj = equipes.map(e => scoreEquipe(e));
            const scores = scoresObj.map(e => e.score);

            let html = `
                <div class="card">
                    <h2 class="card-title">
                        <span class="material-icons">groups</span>
                        Équipes Constituées
                        <button onclick="toggleTotalNiveaux()" class="btn btn-secondary" style="margin-left: auto;">
                            ${afficherTotal ? 'Cacher' : 'Afficher'} totaux
                        </button>
                        <button onclick="toggleTriEquipes()" class="btn btn-secondary" style="margin-left: 8px;">
                            Trier : ${triEquipes === 'niveau' ? 'par niveau' : 'alphabétique'}
                        </button>
                    </h2>
                    <div class="teams-grid">
            `;

            equipes.forEach((e, idx) => {
                const teamColors = ['#1976d2', '#388e3c', '#f57c00', '#d32f2f'];
                const color = teamColors[idx % teamColors.length];

                html += `
                    <div class="team-card">
                        <div class="team-title" style="color: ${color}">
                            <span class="material-icons">group</span>
                            Équipe ${idx + 1}
                        </div>
                        <ul class="team-players">
                `;

                // Tri dynamique des joueurs dans les équipes
                let joueursAffiches = [...e.joueurs];
                if (triEquipes === 'niveau') {
                    joueursAffiches.sort((a, b) => b.niveau - a.niveau);
                } else if (triEquipes === 'alpha') {
                    joueursAffiches.sort((a, b) => a.nom.localeCompare(b.nom, 'fr', { sensitivity: 'base' }));
                }

                joueursAffiches.forEach((j, joueurIdx) => {
                    html += `
                        <li class="team-player" onclick="changerEquipe(${idx}, ${e.joueurs.indexOf(j)})">
                            <span class="material-icons">person</span>
                            ${j.nom} - ${j.poste}
                        </li>
                    `;
                });

                html += '</ul>';
                if (afficherTotal) {
                    html += `<div class="team-total">Score compétitif : ${scoresObj[idx].score.toFixed(2)}<br>
                        <span style="font-size:12px;">
                        (Somme × 0.6 : ${(e.joueurs.length > 6 
                            ? [...e.joueurs].sort((a,b) => b.niveau-a.niveau).slice(0,6).reduce((acc, j) => acc+j.niveau,0)
                            : e.niveauTotal
                        ).toFixed(2)}
                        , meilleur × 0.25 : ${(scoresObj[idx].meilleur*0.25).toFixed(2)}
                        , 2e meilleur × 0.15 : ${(scoresObj[idx].second*0.15).toFixed(2)})
                        </span>`;
                    if (scoresObj[idx].joueursIgnorés.length > 0) {
                        html += `<br><span style="color:#d32f2f; font-size:12px;">(Le(s) joueur(s) non pris en compte : ${scoresObj[idx].joueursIgnorés.map(j => j.nom).join(', ')})</span>`;
                    }
                    html += `</div>`;
                }
                html += '</div>';
            });

            html += '</div>';
            // Rapport de force
            html += `
                <div class="vs-stats">
                    <h3><span class="material-icons">bar_chart</span> Rapport de force entre équipes</h3>
            `;

            equipes.forEach((e1, i) => {
                equipes.forEach((e2, j) => {
                    if (i < j) {
                        const ratio = (scores[i] / scores[j]).toFixed(2);
                        const part1 = (ratio * 100 / (1 + Number(ratio))).toFixed(1);
                        const part2 = (100 / (1 + Number(ratio))).toFixed(1);
                        html += `<div class="vs-row">Équipe ${i + 1} vs Équipe ${j + 1} : ${part1}% / ${part2}%</div>`;
                    }
                });
            });

            html += '</div></div>';
            container.innerHTML = html;
        }

        function changerEquipe(equipeIdx, joueurIdx) {
            const nouvelleEquipe = prompt('Numéro de la nouvelle équipe pour ce joueur (commence à 1) :');
            const numEquipe = parseInt(nouvelleEquipe) - 1;
            if (numEquipe >= 0 && numEquipe < equipes.length && numEquipe !== equipeIdx) {
                const joueur = equipes[equipeIdx].joueurs.splice(joueurIdx, 1)[0];
                equipes[numEquipe].joueurs.push(joueur);

                // Recalculer les totaux
                equipes.forEach(e => {
                    e.niveauTotal = e.joueurs.reduce((acc, j) => acc + j.niveau, 0);
                });

                afficherEquipes();
                showToast('Joueur déplacé avec succès');
            }
        }

        function exporterJoueurs() {
            if (joueurs.length === 0) {
                showToast("Aucun joueur à exporter", true);
                return;
            }

            const contenu = joueurs.map(j => `${j.nom},${j.niveau},${j.poste}`).join('\n');
            const blob = new Blob([contenu], { type: "text/plain;charset=utf-8" });
            const url = URL.createObjectURL(blob);

            const a = document.createElement("a");
            a.style.display = "none";
            a.href = url;
            a.download = "joueurs_exportes.csv";
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            showToast("Joueurs exportés avec succès");
        }

        async function importerJoueurs() {
            const fichier = document.getElementById('fichierJoueurs').files[0];
            if (!fichier) {
                showToast("Aucun fichier sélectionné", true);
                return;
            }

            const reader = new FileReader();
            reader.onload = async function(event) {
                let ajouts = 0;
                const lignes = event.target.result.replace(/\r/g, '').split('\n');
                
                for (const ligne of lignes) {
                    const cleanLine = ligne.replace(/^\uFEFF/, '').trim();
                    if (!cleanLine) continue;

                    const sep = cleanLine.includes(';') ? ';' : ',';
                    const [nom, niveauStr, posteStr] = cleanLine.split(sep).map(x => x.trim());

                    if (!nom) continue;
                    
                    // Vérifier si le joueur existe déjà
                    if (joueurs.find(j => j.nom.toLowerCase() === nom.toLowerCase())) {
                        continue;
                    }
                    
                    const niveau = parseInt(niveauStr);
                    const poste = (posteStr || "").toLowerCase();
                    const posteValide = ["avant", "arriere"].includes(poste) ? poste : "indifferent";
                    const niveauValide = (niveau >= 1 && niveau <= 10) ? niveau : 5;

                    const nouveauJoueur = { nom, niveau: niveauValide, poste: posteValide, groupe: null, actif: true };
                    joueurs.push(nouveauJoueur);
                    await sauvegarderJoueur(nouveauJoueur);
                    ajouts++;
                }
                
                afficherJoueurs();
                showToast(`${ajouts} joueur(s) importé(s) avec succès`);
            };
            reader.readAsText(fichier, 'utf-8');
        }

        // ==================== INITIALISATION ====================
        window.onload = async () => {
            console.log("Page chargée - Initialisation...");
            
            // Initialiser Supabase
            await initSupabase();
            
            // Event listeners
            document.getElementById('ajouterBtn').addEventListener('click', ajouterJoueur);
            document.getElementById('exportBtn').addEventListener('click', exporterJoueurs);
            document.getElementById('creerBtn').addEventListener('click', creerEquipes);
            document.getElementById('syncBtn').addEventListener('click', synchroniser);

            // Auto-import quand un fichier est sélectionné
            document.getElementById('fichierJoueurs').addEventListener('change', importerJoueurs);

            // Recherche et tri
            document.getElementById('searchInput').addEventListener('input', rechercherJoueurs);
            document.getElementById('clearSearch').addEventListener('click', effacerRecherche);
            document.getElementById('sortToggle').addEventListener('click', toggleTriJoueurs);

            // Support clavier
            document.getElementById('nom').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') ajouterJoueur();
            });

            document.getElementById('niveau').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') ajouterJoueur();
            });

            document.getElementById('nombreEquipes').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') creerEquipes();
            });

            document.getElementById('searchInput').addEventListener('keypress', function(e) {
                if (e.key === 'Escape') effacerRecherche();
            });
        };
    </script>
</body>
</html>