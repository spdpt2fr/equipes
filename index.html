<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestionnaire d'√âquipes - Version Simple</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: Arial, sans-serif; max-width: 1000px; margin: 0 auto; padding: 20px; background: #f5f5f5; }
        .card { background: white; padding: 20px; margin: 20px 0; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .status { position: fixed; top: 10px; right: 10px; padding: 10px 20px; border-radius: 20px; color: white; font-weight: bold; z-index: 1000; }
        .connected { background: #4caf50; }
        .offline { background: #f44336; }
        .connecting { background: #ff9800; }
        input, select, button { padding: 10px; margin: 5px; border: 1px solid #ddd; border-radius: 5px; }
        button { background: #2196f3; color: white; cursor: pointer; border: none; }
        button:hover { background: #1976d2; }
        .player { background: #f9f9f9; padding: 15px; margin: 10px 0; border-radius: 5px; display: flex; justify-content: space-between; align-items: center; }
        .team { border: 2px solid #2196f3; margin: 15px 0; padding: 15px; border-radius: 10px; }
        .team h3 { margin: 0 0 10px 0; color: #2196f3; }
        .delete-btn { background: #f44336; padding: 5px 10px; }
        .delete-btn:hover { background: #d32f2f; }
    </style>
</head>
<body>
    <div id="status" class="status connecting">üîÑ Connexion...</div>
    
    <h1 style="text-align: center; color: #2196f3;">üèÜ Gestionnaire d'√âquipes</h1>
    
    <div class="card">
        <h2>Ajouter un joueur</h2>
        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
            <input id="nom" placeholder="Nom du joueur" style="flex: 1; min-width: 150px;">
            <input id="niveau" type="number" min="1" max="10" placeholder="Niveau">
            <select id="poste">
                <option value="avant">Avant</option>
                <option value="arriere">Arri√®re</option>
                <option value="indifferent">Indiff√©rent</option>
            </select>
            <input id="groupe" type="number" min="1" placeholder="Groupe">
            <button onclick="ajouterJoueur()">Ajouter</button>
        </div>
    </div>

    <div class="card">
        <h2>Actions</h2>
        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
            <button onclick="synchroniser()" style="background: #4caf50;">üîÑ Synchroniser</button>
            <input id="nbEquipes" type="number" min="1" placeholder="Nombre d'√©quipes">
            <button onclick="creerEquipes()" style="background: #ff9800;">‚öΩ Cr√©er √âquipes</button>
            <button onclick="viderBase()" style="background: #f44336;">üóëÔ∏è Vider Base</button>
        </div>
    </div>

    <div id="joueursContainer" class="card" style="display: none;">
        <h2>Joueurs (<span id="count">0</span>)</h2>
        <div id="joueursList"></div>
    </div>

    <div id="equipesContainer"></div>

    <script>
        // Configuration Supabase
        const SUPABASE_URL = 'https://wwonmuezjfvtfjjnxczx.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Ind3b25tdWV6amZ2dGZqam54Y3p4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA5NDUxMTQsImV4cCI6MjA2NjUyMTExNH0.P4TY4lyr0aXavzz8tJlZJFb0v2sDFMZstIFH2vvipnw';
        
        let supabaseClient;
        let joueurs = [];
        let equipes = [];
        let isOnline = false;

        // Fonctions utilitaires
        function updateStatus(message, className) {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = 'status ' + className;
        }

        function toast(message, error = false) {
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed; bottom: 20px; right: 20px; 
                background: ${error ? '#f44336' : '#4caf50'}; color: white; 
                padding: 15px 20px; border-radius: 5px; z-index: 1001;
                animation: slideIn 0.3s ease;
            `;
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => document.body.removeChild(toast), 3000);
        }

        // Initialisation
        async function init() {
            try {
                updateStatus('üîÑ Connexion...', 'connecting');
                console.log('Initialisation...');
                
                // Cr√©er client Supabase
                supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                console.log('Client cr√©√©');
                
                // Test connexion
                const { data, error } = await supabaseClient.from('players').select('*');
                if (error) throw error;
                
                isOnline = true;
                joueurs = data || [];
                updateStatus('üü¢ Connect√© (' + joueurs.length + ' joueurs)', 'connected');
                console.log('Connexion OK, joueurs:', joueurs.length);
                afficherJoueurs();
                toast('Connexion Supabase r√©ussie !');
                
            } catch (error) {
                console.error('Erreur:', error);
                isOnline = false;
                updateStatus('üî¥ Hors ligne', 'offline');
                toast('Erreur connexion: ' + error.message, true);
            }
        }

        // Ajouter un joueur
        async function ajouterJoueur() {
            const nom = document.getElementById('nom').value.trim();
            const niveau = parseInt(document.getElementById('niveau').value);
            const poste = document.getElementById('poste').value;
            const groupe = parseInt(document.getElementById('groupe').value) || null;

            if (!nom || !niveau || niveau < 1 || niveau > 10) {
                toast('Veuillez remplir correctement les champs', true);
                return;
            }

            if (joueurs.find(j => j.nom.toLowerCase() === nom.toLowerCase())) {
                toast('Ce joueur existe d√©j√†', true);
                return;
            }

            const nouveauJoueur = { nom, niveau, poste, groupe, actif: true };

            try {
                if (isOnline) {
                    const { data, error } = await supabaseClient
                        .from('players')
                        .insert([nouveauJoueur])
                        .select();
                    
                    if (error) throw error;
                    
                    joueurs.push(data[0]);
                    toast('Joueur ajout√© et synchronis√© !');
                } else {
                    joueurs.push(nouveauJoueur);
                    toast('Joueur ajout√© (mode hors ligne)');
                }

                // Reset formulaire
                document.getElementById('nom').value = '';
                document.getElementById('niveau').value = '';
                document.getElementById('groupe').value = '';
                
                afficherJoueurs();
                updateStatus('üü¢ Connect√© (' + joueurs.length + ' joueurs)', 'connected');

            } catch (error) {
                console.error('Erreur ajout:', error);
                toast('Erreur: ' + error.message, true);
            }
        }

        // Supprimer un joueur
        async function supprimerJoueur(index) {
            if (!confirm('Supprimer ce joueur ?')) return;
            
            const joueur = joueurs[index];
            
            try {
                if (isOnline) {
                    const { error } = await supabaseClient
                        .from('players')
                        .delete()
                        .eq('id', joueur.id);
                    
                    if (error) throw error;
                    toast('Joueur supprim√© de la base !');
                } else {
                    toast('Joueur supprim√© (mode hors ligne)');
                }
                
                joueurs.splice(index, 1);
                afficherJoueurs();
                updateStatus('üü¢ Connect√© (' + joueurs.length + ' joueurs)', 'connected');
                
            } catch (error) {
                console.error('Erreur suppression:', error);
                toast('Erreur: ' + error.message, true);
            }
        }

        // Synchroniser
        async function synchroniser() {
            try {
                updateStatus('üîÑ Synchronisation...', 'connecting');
                
                if (!isOnline) {
                    await init();
                    return;
                }
                
                const { data, error } = await supabaseClient.from('players').select('*');
                if (error) throw error;
                
                joueurs = data || [];
                afficherJoueurs();
                updateStatus('üü¢ Synchronis√© (' + joueurs.length + ' joueurs)', 'connected');
                toast('Synchronisation r√©ussie !');
                
            } catch (error) {
                console.error('Erreur sync:', error);
                toast('Erreur synchronisation: ' + error.message, true);
                updateStatus('üî¥ Erreur sync', 'offline');
            }
        }

        // Vider la base
        async function viderBase() {
            if (!confirm('Vider toute la base de donn√©es ?')) return;
            
            try {
                if (isOnline) {
                    const { error } = await supabaseClient
                        .from('players')
                        .delete()
                        .neq('id', 0); // Supprimer tous
                    
                    if (error) throw error;
                }
                
                joueurs = [];
                afficherJoueurs();
                updateStatus('üü¢ Base vid√©e', 'connected');
                toast('Base de donn√©es vid√©e !');
                
            } catch (error) {
                console.error('Erreur vidage:', error);
                toast('Erreur: ' + error.message, true);
            }
        }

        // Afficher joueurs
        function afficherJoueurs() {
            const container = document.getElementById('joueursContainer');
            const list = document.getElementById('joueursList');
            const count = document.getElementById('count');
            
            count.textContent = joueurs.length;
            
            if (joueurs.length === 0) {
                container.style.display = 'none';
                return;
            }
            
            container.style.display = 'block';
            list.innerHTML = '';
            
            joueurs.forEach((j, index) => {
                const div = document.createElement('div');
                div.className = 'player';
                div.innerHTML = `
                    <div>
                        <strong>${j.nom}</strong> - Niveau ${j.niveau} - ${j.poste}
                        ${j.groupe ? ' (Groupe ' + j.groupe + ')' : ''}
                    </div>
                    <button class="delete-btn" onclick="supprimerJoueur(${index})">Supprimer</button>
                `;
                list.appendChild(div);
            });
        }

        // Cr√©er √©quipes
        function creerEquipes() {
            const nb = parseInt(document.getElementById('nbEquipes').value);
            if (!nb || nb <= 0) {
                toast('Nombre d\'√©quipes invalide', true);
                return;
            }

            if (joueurs.length === 0) {
                toast('Aucun joueur disponible', true);
                return;
            }

            // Algorithme simple
            equipes = Array.from({length: nb}, () => ({ joueurs: [], total: 0 }));
            
            const joueursActifs = [...joueurs].sort((a, b) => b.niveau - a.niveau);
            
            joueursActifs.forEach(joueur => {
                equipes.sort((a, b) => a.total - b.total);
                equipes[0].joueurs.push(joueur);
                equipes[0].total += joueur.niveau;
            });

            afficherEquipes();
            toast('√âquipes cr√©√©es !');
        }

        // Afficher √©quipes
        function afficherEquipes() {
            const container = document.getElementById('equipesContainer');
            
            if (equipes.length === 0) {
                container.innerHTML = '';
                return;
            }

            let html = '<div class="card"><h2>√âquipes Cr√©√©es</h2>';
            
            equipes.forEach((e, index) => {
                html += `
                    <div class="team">
                        <h3>√âquipe ${index + 1} (Total: ${e.total})</h3>
                        <ul>
                `;
                
                e.joueurs.forEach(j => {
                    html += `<li>${j.nom} (${j.niveau}) - ${j.poste}</li>`;
                });
                
                html += '</ul></div>';
            });
            
            html += '</div>';
            container.innerHTML = html;
        }

        // D√©marrage
        window.onload = init;
    </script>
</body>
</html>