<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Supabase - Gestionnaire d'Équipes</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body style="font-family: Arial, sans-serif; max-width: 800px; margin: 50px auto; padding: 20px;">
    <h1>🔍 Test de Connexion Supabase</h1>
    <div id="status" style="padding: 20px; border-radius: 8px; margin: 20px 0; background: #f0f0f0;">
        ⏳ Initialisation...
    </div>
    <div id="results" style="background: #f9f9f9; padding: 20px; border-radius: 8px; font-family: monospace; white-space: pre-wrap;"></div>
    
    <script>
        const SUPABASE_URL = 'https://wwonmuezjfvtfjjnxczx.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Ind3b25tdWV6amZ2dGZqam54Y3p4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA5NDUxMTQsImV4cCI6MjA2NjUyMTExNH0.P4TY4lyr0aXavzz8tJlZJFb0v2sDFMZstIFH2vvipnw';
        
        function log(message) {
            const results = document.getElementById('results');
            results.textContent += new Date().toLocaleTimeString() + ': ' + message + '\n';
            console.log(message);
        }
        
        function updateStatus(message, color) {
            const status = document.getElementById('status');
            status.textContent = message;
            status.style.backgroundColor = color;
            status.style.color = 'white';
        }
        
        async function testSupabase() {
            try {
                log('🔄 Début du test...');
                log('URL: ' + SUPABASE_URL);
                log('Key length: ' + SUPABASE_ANON_KEY.length + ' caractères');
                
                updateStatus('🔄 Création du client Supabase...', '#ff9800');
                
                // Création du client
                const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                log('✅ Client Supabase créé');
                
                updateStatus('🔄 Test de connexion...', '#ff9800');
                
                // Test de connexion
                log('🔄 Test de connexion à la table players...');
                const { data, error, count } = await supabaseClient
                    .from('players')
                    .select('*', { count: 'exact' });
                
                if (error) {
                    throw error;
                }
                
                log('✅ Connexion réussie !');
                log('📊 Nombre de joueurs dans la DB: ' + (count || 0));
                log('📝 Données: ' + JSON.stringify(data, null, 2));
                
                updateStatus('🟢 Connexion Supabase OK (' + (count || 0) + ' joueurs)', '#4caf50');
                
                // Test d'insertion
                log('🔄 Test d\'insertion d\'un joueur...');
                const testPlayer = {
                    nom: 'Test Joueur ' + Date.now(),
                    niveau: 5,
                    poste: 'avant',
                    groupe: null,
                    actif: true
                };
                
                const { data: insertData, error: insertError } = await supabaseClient
                    .from('players')
                    .insert([testPlayer])
                    .select();
                
                if (insertError) {
                    throw insertError;
                }
                
                log('✅ Insertion réussie: ' + JSON.stringify(insertData, null, 2));
                updateStatus('🟢 Test complet réussi !', '#4caf50');
                
            } catch (error) {
                log('❌ ERREUR: ' + error.message);
                log('📋 Détails: ' + JSON.stringify(error, null, 2));
                updateStatus('🔴 Erreur: ' + error.message, '#f44336');
            }
        }
        
        // Démarrer le test au chargement
        window.onload = () => {
            setTimeout(testSupabase, 1000);
        };
    </script>
</body>
</html>